<style>
   #wrapper { position: relative; }
   #over_map { position: absolute; bottom: 30px; left: 10px; z-index: 99; }
</style>

<div id="wrapper">
   <div id="map">
   </div>
   <div id="over_map">
      <a id = "submit"
        href="https://liteventtracker.com/weija2/#/events"><img src = "../img/arrow_left-512.png">
      </a>
   </div>
</div>
<!-- Replace the value of the key parameter with your own API key. -->
<script>
  var QueryString = function () {
    // This function is anonymous, is executed immediately and
    // the return value is assigned to QueryString!
    var query_string = {};
    var query = window.location.search.substring(1);
    var vars = query.split("&");
    for (var i=0;i<vars.length;i++) {
      var pair = vars[i].split("=");
          // If first entry with this name
      if (typeof query_string[pair[0]] === "undefined") {
        query_string[pair[0]] = decodeURIComponent(pair[1]);
          // If second entry with this name
      } else if (typeof query_string[pair[0]] === "string") {
        var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
        query_string[pair[0]] = arr;
          // If third or later entry with this name
      } else {
        query_string[pair[0]].push(decodeURIComponent(pair[1]));
      }
    }
    return query_string;
  }();
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4fnO2ErBKwPTrcRa8yi9DjoinVkC1y8E&callback=initMap">
</script>
<script src="https://www.gstatic.com/firebasejs/3.6.10/firebase.js"></script>

<style type="text/css">
  #map {
  height: 100%;
  z-index: 99;
}
Optional: Makes the sample page fill the window.
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}
</style>
<script>
var map;
var infoWindow;
var centreLat = parseFloat(localStorage.getItem("curCentLat"));
var centreLng = parseFloat(localStorage.getItem("curCentLng"));
localStorage.clear();
function ObjectLength( object ) {
    var length = 0;
    for( var key in object ) {
        if( object.hasOwnProperty(key) ) {
            ++length;
        }
    }
    return length;
};
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: centreLat, lng: centreLng},
    zoom: 17,
  });
  
  var config = {
    apiKey: "AIzaSyBLefPTD2pIO1RAUYxTIN8ao_Xdx054D9Q",
    authDomain: "litapp-a4f8d.firebaseapp.com",
    databaseURL: "https://litapp-a4f8d.firebaseio.com",
    storageBucket: "litapp-a4f8d.appspot.com",
    messagingSenderId: "863295441400"
  };
  firebase.initializeApp(config);
  var refEvent = firebase.database().ref('events')
  refEvent.once("value", function(snapshot) {
    allEventsObj = snapshot.val();
  }).then(function(){
    for (key in allEventsObj){
      var mapcoord = [];
      var numberofGuests = ObjectLength(allEventsObj[key]['guestlist']);
      if (numberofGuests <=1){
        color = "yellow"; 
      } 
      else if (numberofGuests <=3){
        color = "orange"; 
      }
      else{
        color = "red"; 
      }
      for (key2 in allEventsObj[key]['coord']){
          var latitude = parseFloat(allEventsObj[key]['coord'][key2].Lat);
          var longitude = parseFloat(allEventsObj[key]['coord'][key2].Long);
          mapcoord.push({lat: latitude, lng: longitude});
      } 
       polygon = new google.maps.Polygon({
          paths: mapcoord,
          editable: false,
          draggable: false,
          fillColor: color,
          fillOpacity: 0.4,
          strokeWeight: 0.5,
        });
        polygon.setMap(map);
    }
  });
  
  map.addListener('zoom_changed', function() {
  //If zoomed in close, removes theme, logo, and heatmap
  if (map.getZoom() < 17) {
    localStorage.setItem("eventsCentLat", map.getCenter().lat());
    localStorage.setItem("eventsCentLng", map.getCenter().lng());
    location.href = "map.html";
    }
  });
}
</script>